
NAME=ppc add instructions
FILE=bins/elf/ppc/ppc64_fp
ARGS=-appc
CMDS=<<EOF
af
s loc.add_insns
aezi
aezse 15~var_write
EOF
EXPECT=<<EOF
var_write(name: r1, old: 0x0, new: 0x1)
var_write(name: r2, old: 0x0, new: 0x2)
var_write(name: r3, old: 0x0, new: 0x3)
var_write(name: r4, old: 0x0, new: 0x4)
var_write(name: cr0, old: 0x0, new: 0x4)
var_write(name: r10, old: 0x0, new: 0xffffffffffffffff)
var_write(name: r0, old: 0x0, new: 0x0)
var_write(name: ca, old: 0x0, new: 0x1)
var_write(name: cr0, old: 0x4, new: 0x2)
var_write(name: r11, old: 0x0, new: 0xffffffffffff0000)
var_write(name: r11, old: 0xffffffffffff0000, new: 0xffffffffffffffff)
var_write(name: r12, old: 0x0, new: 0x0)
var_write(name: ca, old: 0x1, new: 0x1)
var_write(name: cr0, old: 0x2, new: 0x2)
var_write(name: r13, old: 0x0, new: 0x2)
var_write(name: ca, old: 0x1, new: 0x0)
var_write(name: cr0, old: 0x2, new: 0x4)
var_write(name: r12, old: 0x0, new: 0x0)
var_write(name: ca, old: 0x0, new: 0x1)
var_write(name: cr0, old: 0x4, new: 0x2)
var_write(name: r16, old: 0x0, new: 0x0)
var_write(name: ca, old: 0x1, new: 0x0)
var_write(name: cr0, old: 0x2, new: 0x2)
var_write(name: r12, old: 0x0, new: 0x0)
var_write(name: ca, old: 0x0, new: 0x1)
var_write(name: cr0, old: 0x2, new: 0x2)
var_write(name: r17, old: 0x0, new: 0x1)
var_write(name: ca, old: 0x1, new: 0x0)
var_write(name: cr0, old: 0x2, new: 0x2)
var_write(name: r17, old: 0x1, new: 0xffffffffffffffff)
var_write(name: ca, old: 0x0, new: 0x0)
var_write(name: cr0, old: 0x2, new: 0x8)
EOF
RUN

NAME=ppc sub instructions
FILE=bins/elf/ppc/ppc64_fp
ARGS=-appc
CMDS=<<EOF
af
s loc.sub_insns
aezi
aezse 18~var_write
EOF
EXPECT=<<EOF
var_write(name: r0, old: 0x0, new: 0x0)
var_write(name: r1, old: 0x0, new: 0x1)
var_write(name: r2, old: 0x0, new: 0x2)
var_write(name: r3, old: 0x0, new: 0x3)
var_write(name: r1, old: 0x1, new: 0x1)
var_write(name: cr0, old: 0x0, new: 0x4)
var_write(name: r0, old: 0x0, new: 0x0)
var_write(name: cr0, old: 0x4, new: 0x2)
var_write(name: r11, old: 0x0, new: 0xffffffffffffffff)
var_write(name: cr0, old: 0x2, new: 0x8)
var_write(name: r11, old: 0xffffffffffffffff, new: 0xffffffffffffffff)
var_write(name: ca, old: 0x0, new: 0x0)
var_write(name: cr0, old: 0x8, new: 0x8)
var_write(name: r0, old: 0x0, new: 0x0)
var_write(name: ca, old: 0x0, new: 0x1)
var_write(name: cr0, old: 0x8, new: 0x2)
var_write(name: r11, old: 0xffffffffffffffff, new: 0xffffffffffffffff)
var_write(name: ca, old: 0x1, new: 0x0)
var_write(name: r0, old: 0x0, new: 0x0)
var_write(name: ca, old: 0x0, new: 0x1)
var_write(name: r11, old: 0xffffffffffffffff, new: 0xffffffffffffffff)
var_write(name: ca, old: 0x1, new: 0x0)
var_write(name: cr0, old: 0x2, new: 0x8)
var_write(name: r12, old: 0x0, new: 0xfffffffffffffffe)
var_write(name: ca, old: 0x0, new: 0x0)
var_write(name: cr0, old: 0x8, new: 0x8)
var_write(name: r13, old: 0x0, new: 0xfffffffffffffffd)
var_write(name: ca, old: 0x0, new: 0x1)
var_write(name: cr0, old: 0x8, new: 0x8)
var_write(name: r12, old: 0xfffffffffffffffe, new: 0xfffffffffffffffe)
var_write(name: ca, old: 0x1, new: 0x0)
var_write(name: cr0, old: 0x8, new: 0x8)
var_write(name: r11, old: 0xffffffffffffffff, new: 0xffffffffffffffff)
var_write(name: ca, old: 0x0, new: 0x0)
var_write(name: cr0, old: 0x8, new: 0x8)
var_write(name: r0, old: 0x0, new: 0x0)
var_write(name: ca, old: 0x0, new: 0x1)
var_write(name: cr0, old: 0x8, new: 0x2)
var_write(name: r10, old: 0x0, new: 0x0)
var_write(name: ca, old: 0x1, new: 0x1)
var_write(name: cr0, old: 0x2, new: 0x2)
EOF
RUN

NAME=ppc store instructions
FILE=bins/elf/ppc/ppc64_fp
ARGS=-appc
CMDS=<<EOF
e io.cache=true
aaa
s loc.store_insns
aezi
aezse 15~mem_write
aezse 4~var_write
EOF
EXPECT=<<EOF
mem_write(addr: 0x8001010, old: 0x0, new: 0xff)
mem_write(addr: 0x8001020, old: 0x0, new: 0xffff)
mem_write(addr: 0x8001030, old: 0x0, new: 0xffffffff)
mem_write(addr: 0x8001040, old: 0x0, new: 0xffffffffffffffff)
mem_write(addr: 0x8001010, old: 0xff, new: 0xff)
mem_write(addr: 0x8001020, old: 0xffff, new: 0xffff)
mem_write(addr: 0x8001030, old: 0xffffffff, new: 0xffffffff)
mem_write(addr: 0x8001040, old: 0xffffffffffffffff, new: 0xffffffffffffffff)
var_write(name: r21, old: 0x8001010, new: 0x8001010)
var_write(name: r21, old: 0x8001010, new: 0x8001020)
var_write(name: r21, old: 0x8001020, new: 0x8001030)
var_write(name: r21, old: 0x8001030, new: 0x8001040)
EOF
RUN

NAME=ppc load instructions
FILE=bins/elf/ppc/ppc64_fp
ARGS=-appc
CMDS=<<EOF
e io.cache=true
aaa
s loc.store_insns
aezi
aezs 19
aezse 16~var_write
EOF
EXPECT=<<EOF
var_write(name: r11, old: 0xffffffffffffffff, new: 0x0)
var_write(name: r12, old: 0x10, new: 0x10)
var_write(name: r13, old: 0x20, new: 0x20)
var_write(name: r14, old: 0x30, new: 0x30)
var_write(name: r21, old: 0x8001040, new: 0x8000000)
var_write(name: r21, old: 0x8000000, new: 0x8001010)
var_write(name: r11, old: 0x0, new: 0xff)
var_write(name: r11, old: 0xff, new: 0xffff)
var_write(name: r11, old: 0xffff, new: 0xffffffff)
var_write(name: r11, old: 0xffffffff, new: 0xffffffffffffffff)
var_write(name: r11, old: 0xffffffffffffffff, new: 0xff)
var_write(name: r11, old: 0xff, new: 0xffff)
var_write(name: r11, old: 0xffff, new: 0xffffffff)
var_write(name: r11, old: 0xffffffff, new: 0xffffffffffffffff)
var_write(name: r11, old: 0xffffffffffffffff, new: 0xffffffffffffffff)
var_write(name: r11, old: 0xffffffffffffffff, new: 0xffffffffffffffff)
EOF
RUN

NAME=ppc logical instructions
FILE=bins/elf/ppc/ppc64_fp
ARGS=-appc
CMDS=<<EOF
s loc.logical_insns
aezi
aezse 16~var_write
EOF
EXPECT=<<EOF
var_write(name: r0, old: 0x0, new: 0x0)
var_write(name: r1, old: 0x0, new: 0x1)
var_write(name: r11, old: 0x0, new: 0xffffffffffffffff)
var_write(name: r21, old: 0x0, new: 0x1)
var_write(name: r12, old: 0x0, new: 0xfffffffffffffffe)
var_write(name: r1, old: 0x1, new: 0x1)
var_write(name: cr0, old: 0x0, new: 0x4)
var_write(name: r30, old: 0x0, new: 0xffff0000)
var_write(name: cr0, old: 0x4, new: 0x4)
var_write(name: r1, old: 0x1, new: 0x1)
var_write(name: r12, old: 0xfffffffffffffffe, new: 0xfffffffffffffffe)
var_write(name: r5, old: 0x0, new: 0x5555)
var_write(name: r5, old: 0x5555, new: 0x55550000)
var_write(name: r5, old: 0x55550000, new: 0xffffffffaaaaffff)
var_write(name: r5, old: 0xffffffffaaaaffff, new: 0xffffffffaaaa3333)
var_write(name: r5, old: 0xffffffffaaaa3333, new: 0xffffffff66663333)
var_write(name: r12, old: 0xfffffffffffffffe, new: 0xfffffffffffffffe)
var_write(name: r12, old: 0xfffffffffffffffe, new: 0xfffffffffffffffe)
EOF
RUN

NAME=ppc compare instructions
FILE=bins/elf/ppc/ppc64_fp
ARGS=-appc
CMDS=<<EOF
s loc.compare_insns
aezi
aezs 1 # li r0, 0
aezs 5
aezse 1~var_write
aezs 5
aezse 1~var_write
aezs 5
aezse 1~var_write
aezs 5
aezse 1~var_write
aezs 5
aezse 1~var_write
aezs 5
aezse 1~var_write
aezs 5
aezse 1~var_write
aezs 5
aezse 1~var_write
aezse 4~var_write
EOF
EXPECT=<<EOF
var_write(name: cr0, old: 0x0, new: 0x8)
var_write(name: cr0, old: 0x8, new: 0x8)
var_write(name: cr1, old: 0x0, new: 0x4)
var_write(name: cr1, old: 0x4, new: 0x4)
var_write(name: cr2, old: 0x0, new: 0x8)
var_write(name: cr2, old: 0x8, new: 0x8)
var_write(name: cr3, old: 0x0, new: 0x2)
var_write(name: cr3, old: 0x2, new: 0x2)
var_write(name: cr4, old: 0x0, new: 0x4)
var_write(name: cr5, old: 0x0, new: 0x8)
var_write(name: cr6, old: 0x0, new: 0x8)
var_write(name: cr7, old: 0x0, new: 0x8)
EOF
RUN

NAME=ppc branch instructions
FILE=bins/elf/ppc/ppc64_fp
ARGS=-appc
CMDS=<<EOF
s loc.branch_insns
aezi
aezse 20
EOF
EXPECT=<<EOF
pc_write(old: 0x80002ec, new: 0x80002f0)
var_write(name: r1, old: 0x0, new: 0x1)
pc_write(old: 0x80002f0, new: 0x80002f4)
var_write(name: r20, old: 0x0, new: 0x0)
pc_write(old: 0x80002f4, new: 0x80002f8)
var_write(name: lr, old: 0x0, new: 0x80002f8)
pc_write(old: 0x80002f8, new: 0x8000324)
pc_write(old: 0x8000324, new: 0x8000328)
pc_write(old: 0x8000328, new: 0x80002f8)
pc_write(old: 0x80002f8, new: 0x80002fc)
var_write(name: r20, old: 0x0, new: 0x8000000)
pc_write(old: 0x80002fc, new: 0x8000300)
var_write(name: r20, old: 0x8000000, new: 0x8000324)
pc_write(old: 0x8000300, new: 0x8000304)
var_write(name: ctr, old: 0x0, new: 0x8000324)
pc_write(old: 0x8000304, new: 0x8000308)
var_write(name: lr, old: 0x80002f8, new: 0x8000308)
pc_write(old: 0x8000308, new: 0x8000324)
pc_write(old: 0x8000324, new: 0x8000328)
pc_write(old: 0x8000328, new: 0x8000308)
pc_write(old: 0x8000308, new: 0x800030c)
var_write(name: ctr, old: 0x8000324, new: 0x8000323)
var_write(name: lr, old: 0x8000308, new: 0x800030c)
pc_write(old: 0x800030c, new: 0x8000324)
pc_write(old: 0x8000324, new: 0x8000328)
pc_write(old: 0x8000328, new: 0x800030c)
pc_write(old: 0x800030c, new: 0x8000310)
var_write(name: ctr, old: 0x8000323, new: 0x1)
pc_write(old: 0x8000310, new: 0x8000314)
var_write(name: ctr, old: 0x1, new: 0x0)
var_write(name: lr, old: 0x800030c, new: 0x8000314)
pc_write(old: 0x8000314, new: 0x8000324)
pc_write(old: 0x8000324, new: 0x8000328)
pc_write(old: 0x8000328, new: 0x8000314)
pc_write(old: 0x8000314, new: 0x8000318)
var_write(name: lr, old: 0x8000314, new: 0x8000318)
pc_write(old: 0x8000318, new: 0x8000324)
pc_write(old: 0x8000324, new: 0x8000328)
pc_write(old: 0x8000328, new: 0x8000318)
pc_write(old: 0x8000318, new: 0x800031c)
var_write(name: cr0, old: 0x0, new: 0x2)
pc_write(old: 0x800031c, new: 0x8000320)
var_write(name: lr, old: 0x8000318, new: 0x8000320)
pc_write(old: 0x8000320, new: 0x8000324)
pc_write(old: 0x8000324, new: 0x8000328)
pc_write(old: 0x8000328, new: 0x8000320)
pc_write(old: 0x8000320, new: 0x8000324)
pc_write(old: 0x8000324, new: 0xc0ffe0)
EOF
RUN